(function(jQuery){var dparams={color:"#000000",unpunct:false,"max-length":60,singleton:false,clickout:false,proximity:true,cornered:true,"font-family":$("body").css("font-family"),"error-string":"Sorry, nothing could be found :-(",css:{}};var divstr="<div class='actions'>"+"<div class='left-div'>"+"  <div class='user-sel-text'>Hello World</div>"+"</div>"+"<div class='right-div'>"+"  <div class='close'>X</div>"+"</div>"+"<div style='clear: both;'></div>"+"<div style='clear:both;'></div>"+"<a class='more-info'>More Info.</a>"+"</div>";var prev_open=null;var last_click_at=(new Date()).getTime();var _wh=false;function getSelected(){if(window.getSelection){return window.getSelection()}else if(document.getSelection){return document.getSelection()}else{var selection=document.selection&&document.selection.createRange();if(selection.text){return selection.text}return false}return false}function remove_prev_open(){if(prev_open){prev_open.remove();prev_open=null}}function unpunct(s){return jQuery.trim((s.replace(/[\W]/g," ")).replace(/[\s]+/g," "))}function clickedOnMe(x,y,p,act,e){return e.pageX>=x-p&&e.pageX<=x+act.width()+2*p&&e.pageY>=y-p&&e.pageY<=y+act.height()+2*p}function get_div_start_pos(e,a){var x=parseInt(a.css("left"));var y=parseInt(a.css("top"));var p=13;var widw=a.width()+2*p;var widh=a.height()+2*p+200;var winw=$(window).width();var winh=$(window).height();var otop=$(window).scrollTop();var MAGIC=20;var _candidates=[{x:winw-MAGIC-widw,y:otop+MAGIC},{x:winw-MAGIC-widw,y:otop+winh-widh-MAGIC},{x:MAGIC,y:otop+MAGIC},{x:MAGIC,y:otop+winh-widh-MAGIC}];for(var i in _candidates){var _c=_candidates[i];if(!clickedOnMe(_c.x,_c.y,13,a,e)){return _c}}return{x:x,y:y}}jQuery.fn.zero_clickable=function(params){params=jQuery.extend({},dparams,params);params.color=escape(params.color);if(!_wh&&(params.proximity||params.clickout)){_wh=true;if(params.proximity){$(window).mousemove(function(e){var a=$(".actions");a.each(function(){var p=13;var i=$(this);var x=parseInt(i.css("left"));var y=parseInt(i.css("top"));var cx=x+(i.width()/2.0);var cy=y+(i.height()/2.0);var dx=Math.abs(cx-e.pageX);var dy=Math.abs(cy-e.pageY);var d=Math.sqrt(dx*dx+dy*dy);var _o=1.0;if(clickedOnMe(x,y,p,i,e)){}else{if(d<1000){_o=1.0-((d-100)/1000.0)}else{_o=0.0}}_o=_o<0.15?0.15:_o;i.css("opacity",_o)})})}if(params.clickout){$(window).click(function(e){var curr_click_time=(new Date()).getTime();var prev_click_time=last_click_at;last_click_at=curr_click_time;if(curr_click_time-prev_click_time<500){return}var a=$(".actions");var onAction=false;a.each(function(){if(onAction){return}var p=13;var i=$(this);var x=parseInt(i.css("left"));var y=parseInt(i.css("top"));if(clickedOnMe(x,y,p,i,e)){onAction=true}});if(!onAction){remove_prev_open()}})}}$(this).each(function(){$(this).mouseup(function(e){var st=jQuery.trim(getSelected().toString());if(params.unpunct){st=unpunct(st)}if(st.length==0||st.length>params["max-length"]){return}last_click_at=(new Date()).getTime();var a=$(divstr);a.css("left",e.pageX).css("top",e.pageY);if("id"in params){a.attr("id",params.id)}a.find(".user-sel-text").html(st);a.find("iframe").remove();$("body").append(a);if(params.cornered){var _dp=get_div_start_pos(e,a);a.css("left",_dp.x.toString()+"px").css("top",_dp.y.toString()+"px")}for(var k in params.css){a.css(k,params.css[k])}a.draggable();a.show();if(params.singleton){remove_prev_open();prev_open=a}a.find(".more-info").click(function(){if(a.find("iframe").length>0){return}var i=$("<iframe></iframe>");var q=a.find(".user-sel-text").text();var url="http://dhruvbird.com/ddb/zeroclick.php?color="+params.color+"&font-family="+escape(params["font-family"])+"&q="+escape(q);i.attr("src",url);a.append(i)});a.find("div.close").click(function(){a.remove()});a.mousemove(function(){$(this).css("opacity",1.0)})})})}}(jQuery))